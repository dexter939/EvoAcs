# Environment Variables Reference

Quick reference guide for all ACS system environment variables.

## üöÄ Quick Start

```bash
# Automated setup (recommended)
./scripts/setup-env.sh

# Manual setup
cp .env.example .env
php artisan key:generate
# Edit .env with your values
```

---

## üìã Essential Variables (Minimum Required)

These variables **must** be configured for the system to work:

```bash
# Application
APP_KEY=                          # Auto-generated by php artisan key:generate

# Database
DB_CONNECTION=pgsql               # Use pgsql for production
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=acs_database
DB_USERNAME=acs_user
DB_PASSWORD=your_password

# ACS API
ACS_API_KEY=                      # ‚ö†Ô∏è REQUIRED - Your API authentication key

# TR-369 USP
USP_CONTROLLER_ENDPOINT_ID=proto::acs-controller
USP_WEBSOCKET_PORT=9000          # ‚ö†Ô∏è REQUIRED - WebSocket server port

# MQTT
MQTT_HOST=test.mosquitto.org
MQTT_PORT=1883
```

---

## üìö Complete Variable List

### Application Core

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `APP_NAME` | string | `ACS System` | Application name |
| `APP_ENV` | enum | `local` | Environment: local, staging, production |
| `APP_KEY` | string | - | Encryption key (auto-generated) |
| `APP_DEBUG` | boolean | `true` | Enable debug mode |
| `APP_URL` | url | `http://localhost` | Base application URL |

### Database

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `DB_CONNECTION` | string | `pgsql` | Database driver (pgsql, sqlite) |
| `DB_HOST` | string | `127.0.0.1` | Database server hostname |
| `DB_PORT` | integer | `5432` | Database server port |
| `DB_DATABASE` | string | - | Database name |
| `DB_USERNAME` | string | - | Database username |
| `DB_PASSWORD` | string | - | Database password |

### ACS System

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `ACS_API_KEY` | string | - | **REQUIRED** - API authentication key |

### TR-069 (CWMP)

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `TR069_ENABLED` | boolean | `true` | Enable TR-069 protocol |
| `TR069_SESSION_TIMEOUT` | integer | `300` | Session timeout in seconds |
| `TR069_MAX_ENVELOPE_SIZE` | integer | `32768` | Max SOAP envelope size |
| `TR069_CONNECTION_USERNAME` | string | `admin` | Connection request auth user |
| `TR069_CONNECTION_PASSWORD` | string | `admin123` | Connection request auth password |

### TR-369 (USP) Core

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `USP_CONTROLLER_ENDPOINT_ID` | string | `proto::acs-controller` | **REQUIRED** - Controller endpoint ID |
| `USP_DEFAULT_OUI` | string | `000000` | Default OUI for device registration |
| `USP_DEFAULT_PRODUCT_CLASS` | string | `USP Device` | Default product class |

### MQTT Transport (MTP)

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `MQTT_HOST` | string | - | **REQUIRED** - MQTT broker hostname |
| `MQTT_PORT` | integer | `1883` | MQTT broker port (1883 or 8883 SSL) |
| `MQTT_CLIENT_ID` | string | `acs-controller` | MQTT client identifier |
| `MQTT_USERNAME` | string | - | MQTT auth username (optional) |
| `MQTT_PASSWORD` | string | - | MQTT auth password (optional) |
| `MQTT_CLEAN_SESSION` | boolean | `true` | Clean session on connect |
| `MQTT_ENABLE_LOGGING` | boolean | `true` | Enable MQTT debug logging |
| `MQTT_CONNECT_TIMEOUT` | integer | `60` | Connection timeout (seconds) |
| `MQTT_SOCKET_TIMEOUT` | integer | `5` | Socket timeout (seconds) |
| `MQTT_KEEP_ALIVE_INTERVAL` | integer | `10` | Keep-alive interval (seconds) |
| `MQTT_RESEND_TIMEOUT` | integer | `10` | Message resend timeout |

### WebSocket Transport (MTP)

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `USP_WEBSOCKET_ENABLED` | boolean | `true` | Enable WebSocket server |
| `USP_WEBSOCKET_HOST` | string | `0.0.0.0` | **REQUIRED** - WebSocket bind address |
| `USP_WEBSOCKET_PORT` | integer | `9000` | **REQUIRED** - WebSocket server port |
| `USP_WEBSOCKET_PING_INTERVAL` | integer | `30` | Heartbeat ping interval (seconds) |
| `USP_WEBSOCKET_TIMEOUT` | integer | `90` | Connection timeout (seconds) |
| `USP_WEBSOCKET_SSL` | boolean | `false` | Enable SSL/TLS (production) |
| `USP_WEBSOCKET_CERT_PATH` | string | - | SSL certificate path |
| `USP_WEBSOCKET_KEY_PATH` | string | - | SSL private key path |

### HTTP Transport (MTP)

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `USP_HTTP_ENABLED` | boolean | `true` | Enable HTTP polling endpoint |
| `USP_HTTP_REQUEST_TIMEOUT` | integer | `3600` | Pending request expiration (seconds) |
| `USP_HTTP_MAX_PENDING_REQUESTS` | integer | `1000` | Max pending requests per device |

### Queue System (Laravel Horizon)

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `QUEUE_CONNECTION` | string | `redis` | Queue driver (redis or database) |
| `REDIS_HOST` | string | `127.0.0.1` | **REQUIRED** - Redis server host |
| `REDIS_PORT` | integer | `6379` | Redis server port |
| `REDIS_PASSWORD` | string | - | Redis auth password |
| `REDIS_DB` | integer | `0` | Redis database number |
| `HORIZON_WORKERS` | integer | `5` | Number of queue workers |
| `HORIZON_MAX_PROCESSES` | integer | `10` | Max concurrent processes |
| `HORIZON_TIMEOUT` | integer | `600` | Worker timeout (seconds) |

### Performance & Scaling

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `DB_POOL_MIN` | integer | `2` | Min database connections |
| `DB_POOL_MAX` | integer | `20` | Max database connections |
| `API_RATE_LIMIT` | integer | `60` | API requests per minute |
| `DEVICE_RATE_LIMIT` | integer | `1000` | Device requests per minute |
| `DAEMON_AUTO_RESTART` | boolean | `true` | Auto-restart daemons on failure |
| `DAEMON_MAX_RESTARTS` | integer | `5` | Max restart attempts |

### Monitoring & Observability

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `METRICS_ENABLED` | boolean | `false` | Enable Prometheus metrics |
| `METRICS_PORT` | integer | `9091` | Metrics export port |
| `SENTRY_LARAVEL_DSN` | string | - | Sentry error tracking DSN |
| `SENTRY_TRACES_SAMPLE_RATE` | float | `1.0` | Sentry trace sampling rate |
| `TELESCOPE_ENABLED` | boolean | `false` | Laravel Telescope debugging |

### Security

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `SESSION_ENCRYPT` | boolean | `false` | Encrypt session data |
| `SESSION_SECURE_COOKIE` | boolean | `false` | Use secure cookies (HTTPS) |
| `CORS_ALLOWED_ORIGINS` | string | `*` | CORS allowed origins |
| `TRUSTED_PROXIES` | string | - | Trusted proxy IP ranges |

---

## üîê Security Considerations

### Production Security Checklist

```bash
# ‚úÖ DO in production:
APP_ENV=production
APP_DEBUG=false
ACS_API_KEY=<strong-random-key-32-chars-minimum>
SESSION_ENCRYPT=true
USP_WEBSOCKET_SSL=true
MQTT_PORT=8883  # Use SSL/TLS

# ‚ùå DON'T in production:
APP_DEBUG=true
ACS_API_KEY=dev-api-key
TELESCOPE_ENABLED=true
```

### Generating Secure Keys

```bash
# API Key (32 characters minimum)
openssl rand -hex 16
# Output: a1b2c3d4e5f6789012345678901234ab

# Strong password
openssl rand -base64 24
# Output: Xk7mP9qR3sT5vW8yZ1aC4bD6eF8gH0jK
```

---

## üåç Environment Profiles

### Development (.env.local)

```bash
APP_ENV=local
APP_DEBUG=true
LOG_LEVEL=debug

DB_CONNECTION=sqlite
QUEUE_CONNECTION=database

MQTT_HOST=test.mosquitto.org
MQTT_PORT=1883

USP_WEBSOCKET_PORT=9000
ACS_API_KEY=dev-api-key-for-testing
```

### Staging (.env.staging)

```bash
APP_ENV=staging
APP_DEBUG=true
LOG_LEVEL=info

DB_CONNECTION=pgsql
DB_HOST=staging-db.internal
QUEUE_CONNECTION=redis

MQTT_HOST=staging-mqtt.internal
MQTT_PORT=8883
MQTT_USERNAME=staging-user

USP_WEBSOCKET_PORT=9000
USP_WEBSOCKET_SSL=true
ACS_API_KEY=staging-secure-key-32-chars
```

### Production (.env.production)

```bash
APP_ENV=production
APP_DEBUG=false
LOG_LEVEL=warning

DB_CONNECTION=pgsql
DB_HOST=prod-db.internal
DB_PORT=5432
DB_POOL_MAX=50

QUEUE_CONNECTION=redis
REDIS_HOST=redis-cluster.internal
HORIZON_WORKERS=10
HORIZON_MAX_PROCESSES=50

MQTT_HOST=mqtt-cluster.internal
MQTT_PORT=8883
MQTT_USERNAME=prod-controller
MQTT_PASSWORD=<secure-password>

USP_WEBSOCKET_PORT=9000
USP_WEBSOCKET_SSL=true
USP_WEBSOCKET_CERT_PATH=/etc/ssl/certs/websocket.crt
USP_WEBSOCKET_KEY_PATH=/etc/ssl/private/websocket.key

ACS_API_KEY=<production-api-key-64-chars>
API_RATE_LIMIT=100
DEVICE_RATE_LIMIT=5000

METRICS_ENABLED=true
SENTRY_LARAVEL_DSN=https://xxx@sentry.io/yyy
```

---

## üêõ Troubleshooting

### Common Issues

#### 1. "ACS_API_KEY not configured"
```bash
# Add to .env:
ACS_API_KEY=your-secret-key-here
```

#### 2. "WebSocket port not set"
```bash
# Add to .env:
USP_WEBSOCKET_PORT=9000
USP_WEBSOCKET_HOST=0.0.0.0
```

#### 3. "MQTT connection failed"
```bash
# Check broker settings:
MQTT_HOST=test.mosquitto.org
MQTT_PORT=1883

# Test connection:
php artisan usp:test-mqtt
```

#### 4. "Queue not processing"
```bash
# Switch to Redis queue:
QUEUE_CONNECTION=redis
REDIS_HOST=127.0.0.1
REDIS_PORT=6379

# Restart Horizon:
php artisan horizon:terminate
php artisan horizon
```

---

## üìñ Related Documentation

- [Environment Setup Guide](ENVIRONMENT_SETUP.md) - Detailed setup instructions
- [Deployment Guide](DEPLOYMENT.md) - Production deployment
- [API Documentation](USP_API_Documentation.md) - API reference
- [Main README](../README.md) - Project overview

---

## üîó External Resources

- [Laravel Environment Configuration](https://laravel.com/docs/11.x/configuration)
- [TR-369 USP Specification](https://www.broadband-forum.org/technical/download/TR-369.pdf)
- [MQTT Protocol](https://mqtt.org/)
- [WebSocket RFC 6455](https://tools.ietf.org/html/rfc6455)
